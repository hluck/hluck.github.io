<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hluck.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="纸上得来终觉浅，绝知此事要躬行。">
<meta property="og:type" content="website">
<meta property="og:title" content="余一">
<meta property="og:url" content="https://hluck.github.io/page/6/index.html">
<meta property="og:site_name" content="余一">
<meta property="og:description" content="纸上得来终觉浅，绝知此事要躬行。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="余一">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://hluck.github.io/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>余一</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="余一" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">余一</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">纸上得来终觉浅，绝知此事要躬行。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/26/%E6%96%87%E4%BB%B6IO%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/26/%E6%96%87%E4%BB%B6IO%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">文件I/O操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-26 14:52:39" itemprop="dateCreated datePublished" datetime="2022-05-26T14:52:39+08:00">2022-05-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-28 14:57:38" itemprop="dateModified" datetime="2022-05-28T14:57:38+08:00">2022-05-28</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>​    为保证App 正常读写外部存储，需在AndroidManifest. xml中增加SD卡的权限配置，具体的配置信息如下所示:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:ignore</span>=<span class="string">"ProtectedPermissions"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    Android从7.0开始加强了SD 卡的权限管理，即使App声明了完整的SD卡操作权限，系统仍然默认禁止该App访问外部存储。</p>
<p>​    不过系统默认关闭存储其实只是关闭外部存储的公共空间，外部存储的私有空间依然可以正常读写。这是缘于<strong>Android把外部存储分成了两块区域，一块是所有应用均可访问的公共空间，另一块是只有应用自己才可访问的专享空间。</strong>之前说过，内部存储保存着每个应用的安装目录，但是安装目录的空间是很紧张的，所以Android 在SD卡的「Android/data」 目录下给每个应用又单独建了一个文件目录，用于给应用保存自己需要处理的临时文件。这个给每个应用单独建立的文件目录只有当前应用才能够读写文件，其他应用是不允许进行读写的，故而「Android/data」 目录算是外部存储上的私有空间。这个私有空间本身已经做了访问权限控制，因此它不受系统禁止访问的影响，应用操作自己的文件目录就不成问题了。当然，因为私有的文件目录只有属主应用才能访问，所以一旦属主应用被用户卸载，那么对应的文件目录也会一起被清理掉。既然外部存储分成了公共空间和私有空间两部分，这两部分空间的路径获取也就有所不同。获取公共空间的存储路径调用的是Environment. getExternalStoragePublicDirectory方法，获取应用私有空间的存储路径调用的是getExternalFilesDir 方法。下面是分别获取两个空间路径的Kotlin 代码例子:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        <span class="comment">//获取系统的公共存储路径</span></span><br><span class="line">        <span class="keyword">val</span> publicPath = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS).toString()</span><br><span class="line">        <span class="comment">//获取当前App的私有存储路径</span></span><br><span class="line">        <span class="keyword">val</span> privatePath = getExternalFilesDir(Environment.DIRECTORY_DOWNLOADS).toString()</span><br><span class="line"></span><br><span class="line">        Log.i(<span class="string">"public"</span>,publicPath)</span><br><span class="line">        Log.i(<span class="string">"private"</span>,privatePath)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/26/%E6%96%87%E4%BB%B6IO%E6%93%8D%E4%BD%9C/1.png" alt></p>
<h2 id="Kotlin读写文本"><a href="#Kotlin读写文本" class="headerlink" title="Kotlin读写文本"></a>Kotlin读写文本</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//覆盖写入文本</span></span><br><span class="line">File(<span class="string">"file_path"</span>).writeText(<span class="string">"content"</span>)</span><br><span class="line"><span class="comment">//追加写入文本</span></span><br><span class="line">File(<span class="string">"file_path"</span>).appendText(<span class="string">"content"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取文本内容</span></span><br><span class="line"><span class="keyword">val</span> content = File(<span class="string">"file_path"</span>).readText()</span><br><span class="line"><span class="comment">//按行读取文本内容</span></span><br><span class="line"><span class="keyword">val</span> content1 = File(<span class="string">"file_path"</span>).readLines()</span><br></pre></td></tr></table></figure>

<h2 id="Kotlin读写图片文件"><a href="#Kotlin读写图片文件" class="headerlink" title="Kotlin读写图片文件"></a>Kotlin读写图片文件</h2><p>​        像图片等二进制格式的文件，可通过字节数组的形式写入文件，Kotlin提供了writeBytes 方法用于覆盖写入字节数组，也提供了appendBytes方法用于追加字节数组。不过由于图像存储比较特殊，牵涉到压缩格式与压<br>缩质量，因此还得通过输出流来处理(这是Bitmap的compress方法要求的）：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">saveImage</span><span class="params">(path: <span class="type">String</span>, bitmap: <span class="type">Bitmap</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">val</span> file = File(path)</span><br><span class="line">            <span class="comment">//outputStream获取文件的输出流对象</span></span><br><span class="line">            <span class="comment">//writer获取文件的Writer对象</span></span><br><span class="line">            <span class="comment">//printWriter获取文件的PrintWriter对象</span></span><br><span class="line">            <span class="keyword">val</span> fos: OutputStream = file.outputStream()</span><br><span class="line">            <span class="comment">//压缩格式为JPEG图像，压缩质量为80%</span></span><br><span class="line">            bitmap.compress(Bitmap.CompressFormat.JPEG, <span class="number">80</span>, fos)</span><br><span class="line">            fos.flush()</span><br><span class="line">            fos.close()</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​        若想从图片文件中读取位图信息，按上面的writeBytes 使用说明，应能调用readBytes 方法。该办法确实可行，因为<strong>Android 的位图工厂Bi tmapFactory刚好提供了decodeByteArray 函数，用于从字节数组中解析位图，</strong>具体代码如下所示:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式一：利用字节数组读取位图</span></span><br><span class="line"><span class="comment">//readBytes读取字节数组形式的文件内容</span></span><br><span class="line"><span class="keyword">val</span> bytes = File(file_path).readBytes()</span><br><span class="line"><span class="comment">//decodeByteArray从字节数组解析图片</span></span><br><span class="line"><span class="keyword">val</span> bitmap = BitmapFactory.decodeByteArray(bytes, <span class="number">0</span>, bytes.size)</span><br><span class="line"><span class="comment">//方式二：利用输入流读取位图</span></span><br><span class="line"><span class="comment">//inputStream获取文件的输入流对象</span></span><br><span class="line"><span class="keyword">val</span> fis = File(file_path).inputStream()</span><br><span class="line"><span class="comment">//decodeStream从输入流解析图片</span></span><br><span class="line"><span class="keyword">val</span> bitmap = BitmapFactory.decodeStream(fis)</span><br><span class="line">fis.close()</span><br><span class="line"><span class="comment">//方式三：直接从文件路径获取位图</span></span><br><span class="line"><span class="comment">//decodeFile从指定路径解析图片</span></span><br><span class="line"><span class="keyword">val</span> bitmap = BitmapFactory.decodeFile(file_path)</span><br><span class="line">iv_image.setImageBitmap(bitmap)</span><br></pre></td></tr></table></figure>

<h2 id="遍历文件目录"><a href="#遍历文件目录" class="headerlink" title="遍历文件目录"></a>遍历文件目录</h2><p>​        写文件和读文件是处理单个文件，没有太复杂的需求。倘若要求遍历某个目录下面的所有文本文件或者图片文件，那就麻烦了，因为该功能的需求点很丰富，例如要不要到子目录和孙子目录下搜索、文件跟文件夹都要匹配还是只匹配其中之一、筛选条件的文件扩展名都有哪些。</p>
<p>​        现在有了Kotlin就方便多了，因为<strong>Kotlin把目录遍历这个功能重新梳理了一下，归纳为FileTreeWalk 文件树，通过给文件树设置各式各样的参数与条件即可化繁为简，轻轻松松获取文件的搜索结果。文件树的使用很简单，首先调用File 对象的walk方法得到FileTreeWalk 实例，接着依次为该实例设置具体的条件，包括遍历深度、是否匹配文件夹、文件扩展名以及最后的文件队列循环处理。</strong>心动不如行动，快来看看Kotlin 的文件遍历是怎么实现的，下面是搜寻指定目录下面所有文本文件的示例代码: </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fileNames:MutableList&lt;String&gt; = mutableListOf()</span><br><span class="line"><span class="comment">//在该目录下走一圈，得到文件目录树结构</span></span><br><span class="line"><span class="keyword">val</span> fileTree:FileTreeWalk = File(<span class="string">"path"</span>).walk()</span><br><span class="line"><span class="comment">//遍历的目录层级为1，即无需检查子目录</span></span><br><span class="line">fileTree.maxDepth(<span class="number">1</span>)</span><br><span class="line">	.filter &#123; it.isFile &#125; <span class="comment">//只挑选文件，不处理文件夹</span></span><br><span class="line">	.filter &#123; it.extension == <span class="string">"txt"</span> &#125; <span class="comment">//选择扩展名为txt的文本文件</span></span><br><span class="line">	.forEach &#123; fileNames.add(it.name) &#125; <span class="comment">//循环处理符合条件的文件</span></span><br></pre></td></tr></table></figure>

<p>假如扩展名有多个，比如图片，则用in条件：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fileNames:MutableList&lt;String&gt; = mutableListOf()</span><br><span class="line"><span class="comment">//在该目录下走一圈，得到文件目录树结构</span></span><br><span class="line"><span class="keyword">val</span> fileTree:FileTreeWalk = File(<span class="string">"path"</span>).walk()</span><br><span class="line"><span class="comment">//遍历的目录层级为1，即无需检查子目录</span></span><br><span class="line">fileTree.maxDepth(<span class="number">1</span>)</span><br><span class="line">	.filter &#123; it.isFile &#125; <span class="comment">//只挑选文件，不处理文件夹</span></span><br><span class="line">	.filter &#123; it.extension <span class="keyword">in</span> listOf(<span class="string">"png"</span>,<span class="string">"jpg"</span>) &#125;</span><br><span class="line">	.forEach &#123; fileNames.add(it.name) &#125; <span class="comment">//循环处理符合条件的文件</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/20/Android%E4%BD%BF%E7%94%A8Kotlin%E5%8D%8F%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/20/Android%E4%BD%BF%E7%94%A8Kotlin%E5%8D%8F%E7%A8%8B/" class="post-title-link" itemprop="url">Android使用Kotlin协程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-20 10:36:18" itemprop="dateCreated datePublished" datetime="2022-05-20T10:36:18+08:00">2022-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-03 14:53:47" itemprop="dateModified" datetime="2022-06-03T14:53:47+08:00">2022-06-03</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>先引入相关扩展库组件库：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation "androidx.activity:activity-ktx:1.2.2"</span><br><span class="line">implementation "androidx.fragment:fragment-ktx:1.3.3"</span><br></pre></td></tr></table></figure>

<p>​        之前使用协程的方式都是通过<code>runBlocking</code>或者使用<code>GlobalScope</code>的<code>launch</code>、<code>async</code>方式启动，当然也可以通过创建一个新的<code>CoroutineScope</code>, 然后通过<code>launch</code>或者<code>async</code>方式启动一个新的协程。<code>协程异常处理</code>的篇章中就提到，通过<code>SupervisorJob</code>和<code>CoroutineExceptionHandler</code>实现了一个和<code>supervisorScope</code>相同的作用域。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> exceptionHandler = CoroutineExceptionHandler&#123;</span><br><span class="line">            coroutineContext, throwable -&gt;</span><br><span class="line">            run &#123;</span><br><span class="line">                Log.d(<span class="string">"exceptionHandler"</span>, <span class="string">"<span class="subst">$&#123;coroutineContext[CoroutineName]&#125;</span> <span class="variable">$throwable</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> supervisorScope = CoroutineScope(SupervisorJob() + exceptionHandler)</span><br><span class="line">        with(supervisorScope)&#123;</span><br><span class="line">            launch &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/20/Android%E4%BD%BF%E7%94%A8Kotlin%E5%8D%8F%E7%A8%8B/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/19/Kotlin%E5%8D%8F%E7%A8%8B%EF%BC%88%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/19/Kotlin%E5%8D%8F%E7%A8%8B%EF%BC%88%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%EF%BC%89/" class="post-title-link" itemprop="url">Kotlin协程（基础用法）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-19 14:39:00" itemprop="dateCreated datePublished" datetime="2022-05-19T14:39:00+08:00">2022-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-03 14:53:23" itemprop="dateModified" datetime="2022-06-03T14:53:23+08:00">2022-06-03</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://juejin.cn/post/6953441828100112392" target="_blank" rel="noopener">转载文章</a></p>
<p>在 app 的<code>build.gradle</code>中引用相关配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Kotlin</span><br><span class="line">    implementation "org.jetbrains.kotlin:kotlin-stdlib:1.4.32"</span><br><span class="line">    // 协程核心库</span><br><span class="line">    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:1.4.3"</span><br><span class="line">    // 协程Android支持库</span><br><span class="line">    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:1.4.3"</span><br></pre></td></tr></table></figure>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​        以同步的方式去编写异步执行的代码。协程是依赖于线程，但是协程挂起时不需要阻塞线程，几乎是无代价的。所以协程像是一种用户态的线程，非常轻量级，一个线程中可以创建 N 个协程。</p>
<h2 id="启动方式"><a href="#启动方式" class="headerlink" title="启动方式"></a>启动方式</h2><p>协程的创建是过<code>CoroutineScope</code>创建, 协程的启动方式有三种：</p>
<ol>
<li><code>runBlocking：T</code> 启动一个新的协程并阻塞调用它的线程，直到里面的代码执行完毕, 返回值是泛型<code>T</code>，就是你协程体中最后一行是什么类型，最终返回的是什么类型<code>T</code>就是什么类型。</li>
<li><code>launch：Job</code> 启动一个协程但不会阻塞调用线程, <strong>必须要在协程作用域 (<code>CoroutineScope</code>) 中才能调用</strong>, 返回值是一个 Job。</li>
<li><code>async:Deferred&lt;T&gt;</code> 启动一个协程但不会阻塞调用线程,<strong>必须要在协程作用域 (<code>CoroutineScope</code>) 中才能调用</strong>。以<code>Deferred</code>对象的形式返回协程任务。返回值泛型<code>T</code>同<code>runBlocking</code>类似都是协程体最后一行的类型。</li>
</ol>
<h3 id="什么是Job，Deferred，协程作用域"><a href="#什么是Job，Deferred，协程作用域" class="headerlink" title="什么是Job，Deferred，协程作用域"></a>什么是Job，Deferred，协程作用域</h3><h4 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h4><p>​    <code>Job</code>我们可以认为他就是一个协程作业是通过<code>CoroutineScope.launch</code>生成的，同时它运行一个指定的代码块，并在该代码块完成时完成。我们可以通过<code>isActive</code>、<code>isCompleted</code>、<code>isCancelled</code>来获取到<code>Job</code>的当前状态。<code>Job</code>的状态如下图所示，摘自官方文档：</p>
<p><img src="/2022/05/19/Kotlin%E5%8D%8F%E7%A8%8B%EF%BC%88%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%EF%BC%89/1.png" alt></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/19/Kotlin%E5%8D%8F%E7%A8%8B%EF%BC%88%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%EF%BC%89/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/18/RxJava%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/18/RxJava%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6/" class="post-title-link" itemprop="url">RxJava常用操作符</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-18 13:59:28" itemprop="dateCreated datePublished" datetime="2022-05-18T13:59:28+08:00">2022-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-19 21:47:39" itemprop="dateModified" datetime="2022-05-19T21:47:39+08:00">2022-05-19</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转载<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTYzNzM5OA==&mid=2247508814&idx=1&sn=e36f5be5cf23d84ade1852ec648fbd31&source=41#wechat_redirect" target="_blank" rel="noopener">RxJava常用操作符</a></p>
<h2 id="Observable的创建"><a href="#Observable的创建" class="headerlink" title="Observable的创建"></a>Observable的创建</h2><ol>
<li>from()</li>
<li>just()</li>
<li>create()</li>
<li>interval()</li>
<li>timer()</li>
<li>range()</li>
<li>error()   </li>
<li>defer()</li>
</ol>
<h3 id="from"><a href="#from" class="headerlink" title="from()"></a>from()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">from</span><span class="params">(Iterable&lt;? extends T&gt; iterable)</span></span>;</span><br></pre></td></tr></table></figure>

<p>转换集合为一个每次发射集合中一个元素的 Observable 对象。</p>
<p><strong>使用场景：对集合（数组、List 等）进行遍历。</strong></p>
<p><img src="/2022/05/18/RxJava%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6/1.png" alt></p>
<p><strong>其他 form() API：</strong></p>
<ul>
<li>public static <T> Observable<T> from(Future&lt;? extends T&gt; future);</T></T></li>
<li>public static <T> Observable<T> from(Future&lt;? extends T&gt; future, long timeout, TimeUnit unit);</T></T></li>
<li>public static <T> Observable<T> from(Future&lt;? extends T&gt; future, Scheduler scheduler);</T></T></li>
<li>public static <T> Observable<T> from(T[] array);</T></T></li>
</ul>
<p><strong>举例：</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.遍历数组</span></span><br><span class="line">Observable.fromArray(<span class="string">"a"</span>,<span class="string">"b"</span>)</span><br><span class="line"><span class="comment">//2.使用Future创建Observable,Future表示一个异步计算的结果</span></span><br><span class="line"><span class="keyword">val</span> futureTask = FutureTask&lt;String&gt;(<span class="keyword">object</span> :Callable&lt;String&gt;&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">call</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"a"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">val</span> worker:Scheduler.Worker = Schedulers.io().createWorker();</span><br><span class="line">worker.schedule &#123;</span><br><span class="line">    futureTask.run()</span><br><span class="line">&#125;</span><br><span class="line">Observable.fromFuture(futureTask)</span><br></pre></td></tr></table></figure>

<h3 id="just"><a href="#just" class="headerlink" title="just()"></a>just()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">just</span><span class="params">(<span class="keyword">final</span> T value)</span></span>;</span><br></pre></td></tr></table></figure>

<p>转换一个或多个 Object 为依次发射这些 Object 的 Observable 对象。</p>
<p><strong>使用场景：转换一个或多个普通 Object 为 Observable 对象，如转换数据库查询结果、网络查询结果等。</strong></p>
<p><img src="/2022/05/18/RxJava%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6/2.png" alt></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/18/RxJava%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/18/RxJava2(Flowable)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/18/RxJava2(Flowable)/" class="post-title-link" itemprop="url">RxJava2(Flowable)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-18 10:51:52" itemprop="dateCreated datePublished" datetime="2022-05-18T10:51:52+08:00">2022-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-19 21:49:08" itemprop="dateModified" datetime="2022-05-19T21:49:08+08:00">2022-05-19</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Flowable"><a href="#Flowable" class="headerlink" title="Flowable"></a>Flowable</h2><p><img src="/2022/05/18/RxJava2(Flowable)/1.png" alt></p>
<p>​        之前我们所的上游和下游分别是 Observable 和 Observer, 这次不一样的是<strong>上游变成了 Flowable, 下游变成了 Subscriber</strong>, 但是水管之间的连接还是通过 subscribe(), 我们来看看最基本的用法吧:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> upstream = Flowable.create&lt;<span class="built_in">Int</span>&gt;(&#123;</span><br><span class="line">            Log.d(TAG, <span class="string">"emit 1"</span>)</span><br><span class="line">            it.onNext(<span class="number">1</span>)</span><br><span class="line">            Log.d(TAG, <span class="string">"emit 2"</span>)</span><br><span class="line">            it.onNext(<span class="number">2</span>)</span><br><span class="line">            Log.d(TAG, <span class="string">"emit 3"</span>)</span><br><span class="line">            it.onNext(<span class="number">3</span>)</span><br><span class="line">            Log.d(TAG, <span class="string">"emit complete"</span>)</span><br><span class="line">            it.onComplete()</span><br><span class="line">        &#125;, BackpressureStrategy.ERROR).subscribe(<span class="keyword">object</span> :Subscriber&lt;<span class="built_in">Int</span>&gt;&#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSubscribe</span><span class="params">(s: <span class="type">Subscription</span>?)</span></span> &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"onSubscribe"</span>)</span><br><span class="line">                s?.request(<span class="built_in">Long</span>.MAX_VALUE)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNext</span><span class="params">(t: <span class="type">Int</span>?)</span></span> &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"onNext:<span class="variable">$t</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(t: <span class="type">Throwable</span>?)</span></span> &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"onError:<span class="variable">$t</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onComplete</span><span class="params">()</span></span> &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"onComplete"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/18/RxJava2(Flowable)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/18/RxJava2(%E4%BA%94%E8%83%8C%E5%8E%8B)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/18/RxJava2(%E4%BA%94%E8%83%8C%E5%8E%8B)/" class="post-title-link" itemprop="url">RxJava2(五背压)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-18 10:05:46" itemprop="dateCreated datePublished" datetime="2022-05-18T10:05:46+08:00">2022-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-19 21:45:44" itemprop="dateModified" datetime="2022-05-19T21:45:44+08:00">2022-05-19</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背压"><a href="#背压" class="headerlink" title="背压"></a>背压</h2><p>转载<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTYzNzM5OA==&mid=2247508825&idx=1&sn=7a344feff1d3d88d19ab9e8dd929e1b4&source=41#wechat_redirect" target="_blank" rel="noopener">给初学者的RxJava2教程（五）</a></p>
<p>​        Zip 可以将多个上游发送的事件组合起来发送给下游, 如果其中一个水管 A 发送事件特别快, 而另一个水管 B 发送事件特别慢, 那就可能出现这种情况, 发得快的水管 A 已经发送了 1000 个事件了, 而发的慢的水管 B 才发一个出来, 组合了一个之后水管 A 还剩 999 个事件, 这些事件需要继续等待水管 B 发送事件出来组合, 那么这么多的事件是放在哪里的呢? 总有一个地方保存吧? 没错, Zip 给我们的每一根水管都弄了一个水缸 , 用来保存这些事件, 用通俗易懂的图片来表示就是:</p>
<p><img src="/2022/05/18/RxJava2(%E4%BA%94%E8%83%8C%E5%8E%8B)/1.png" alt></p>
<p>​        如图中所示, 其中蓝色的框框就是 zip 给我们的水缸! 它将每根水管发出的事件保存起来, 等两个水缸都有事件了之后就分别从水缸中取出一个事件来组合, 当其中一个水缸是空的时候就处于等待的状态.它是按顺序保存的, 先进来的事件先取出来，<strong>水缸在 Zip 内部的实现就是用的队列.</strong></p>
<p>​        <strong>所谓的 Backpressure 其实就是为了控制流量</strong>，缸存储的能力毕竟有限, 因此我们还得从源头去解决问题, 既然你发那么快, 数据量那么大, 那我就想办法不让你发那么快呗.</p>
<p>​        当上下游工作在同一个线程中时, 这时候是一个<strong>同步</strong>的订阅关系, 也就是说上游每发送一个事件必须等到下游接收处理完了以后才能接着发送下一个事件.</p>
<p>​        当上下游工作在不同的线程中时, 这时候是一个<strong>异步</strong>的订阅关系, 这个时候上游发送数据不需要等待下游接收, 为什么呢, 因为两个线程并不能直接进行通信, 因此上游发送的事件并不能直接到下游里去, 这个时候就需要一个田螺姑娘来帮助它们俩, 这个田螺姑娘就是我们刚才说的水缸 ! 上游把事件发送到水缸里去, 下游从水缸里取出事件来处理, 因此, 当上游发事件的速度太快, 下游取事件的速度太慢, 水缸就会迅速装满, 然后溢出来, 最后就 OOM 了.</p>
<p>同步：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/18/RxJava2(%E4%BA%94%E8%83%8C%E5%8E%8B)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/17/RxJava2(%E5%9B%9Bzip%E6%93%8D%E4%BD%9C%E7%AC%A6)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/17/RxJava2(%E5%9B%9Bzip%E6%93%8D%E4%BD%9C%E7%AC%A6)/" class="post-title-link" itemprop="url">RxJava2(四zip操作符)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-05-17 17:02:48 / 修改时间：20:27:05" itemprop="dateCreated datePublished" datetime="2022-05-17T17:02:48+08:00">2022-05-17</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<p> title: RxJava2(四zip操作符)<br> tag: Android<br> top: 66</p>
<hr>
<p>参考<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTYzNzM5OA==&mid=2247508821&idx=1&sn=70fd32177454631d64672989c702824b&source=41#wechat_redirect" target="_blank" rel="noopener">给初学者的 RxJava2.0 教程 (四) ：zip 操作符使用</a></p>
<h2 id="Zip"><a href="#Zip" class="headerlink" title="Zip"></a>Zip</h2><p>​        <strong>Zip 通过一个函数将多个 Observable 发送的事件结合到一起，然后发送这些组合到一起的事件. 它按照严格的顺序应用这个函数。它只发射与发射数据项最少的那个 Observable 一样多的数据。</strong></p>
<p><img src="/2022/05/17/RxJava2(%E5%9B%9Bzip%E6%93%8D%E4%BD%9C%E7%AC%A6)/1.png" alt></p>
<p>​        如图，其中一根水管负责发送圆形事件 , 另外一根水管负责发送三角形事件 , 通过 Zip 操作符, 使得圆形事件 和三角形事件合并为了一个矩形事件 .</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/17/RxJava2(%E5%9B%9Bzip%E6%93%8D%E4%BD%9C%E7%AC%A6)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/17/RxJava2(%E4%B8%89map%E5%92%8CflatMap)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/17/RxJava2(%E4%B8%89map%E5%92%8CflatMap)/" class="post-title-link" itemprop="url">RxJava2(三map和flatMap)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-05-17 09:01:00 / 修改时间：20:25:28" itemprop="dateCreated datePublished" datetime="2022-05-17T09:01:00+08:00">2022-05-17</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>借鉴文章<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTYzNzM5OA==&mid=2247508818&idx=1&sn=bfdb021a851246f6d1e417009b202343&source=41#wechat_redirect" target="_blank" rel="noopener">RxJava2.0(三)</a></p>
<h2 id="Map和FlatMap"><a href="#Map和FlatMap" class="headerlink" title="Map和FlatMap"></a>Map和FlatMap</h2><p>如果是一个新用户, 必须先注册, 等注册成功之后再自动登录该怎么做呢.</p>
<p>很明显, 这是一个嵌套的网络请求, 首先需要去请求注册, 待注册成功回调了再去请求登录的接口.</p>
<p>我们当然可以想当然的写成这样:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">    api.login(Request())</span><br><span class="line">    .subscribeOn(Schedulers.io())</span><br><span class="line">    .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">    .subscribe(<span class="keyword">object</span> : Observer&lt;Response&gt;&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSubscribe</span><span class="params">(d: <span class="type">Disposable</span>)</span></span> &#123;</span><br><span class="line">            TODO(<span class="string">"Not yet implemented"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNext</span><span class="params">(t: <span class="type">Response</span>)</span></span> &#123;</span><br><span class="line">            TODO(<span class="string">"Not yet implemented"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e: <span class="type">Throwable</span>)</span></span> &#123;</span><br><span class="line">            Log.d(TAG,<span class="string">"登录失败"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onComplete</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Log.d(TAG,<span class="string">"登录成功"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">register</span><span class="params">()</span></span>&#123;</span><br><span class="line">    api.register(Request())</span><br><span class="line">    .subscribeOn(Schedulers.io())</span><br><span class="line">    .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">    .subscribe(&#123;</span><br><span class="line">        Log.d(TAG,<span class="string">"注册成功"</span>)</span><br><span class="line">        login()</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        Log.d(TAG,<span class="string">"注册失败"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/17/RxJava2(%E4%B8%89map%E5%92%8CflatMap)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/16/RxJava2(%E4%BA%8C)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/16/RxJava2(%E4%BA%8C)/" class="post-title-link" itemprop="url">RxJava2(线程控制二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-16 15:49:57" itemprop="dateCreated datePublished" datetime="2022-05-16T15:49:57+08:00">2022-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-17 20:23:03" itemprop="dateModified" datetime="2022-05-17T20:23:03+08:00">2022-05-17</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="线程控制"><a href="#线程控制" class="headerlink" title="线程控制"></a>线程控制</h2><p>借鉴文章<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTYzNzM5OA==&mid=2247508817&idx=1&sn=74fe92631740034f1312da8b7eac1b4a&source=41#wechat_redirect" target="_blank" rel="noopener">RxJava2(线程控制二)</a></p>
<p><img src="/2022/05/16/RxJava2(%E4%BA%8C)/1.png" alt></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/16/RxJava2(%E4%BA%8C)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hluck.github.io/2022/05/16/RxJava2(%E4%B8%80)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar5.jpg">
      <meta itemprop="name" content="余一">
      <meta itemprop="description" content="纸上得来终觉浅，绝知此事要躬行。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="余一">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/16/RxJava2(%E4%B8%80)/" class="post-title-link" itemprop="url">RxJava2(一基本工作原理)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-16 11:58:09" itemprop="dateCreated datePublished" datetime="2022-05-16T11:58:09+08:00">2022-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-17 20:29:17" itemprop="dateModified" datetime="2022-05-17T20:29:17+08:00">2022-05-17</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>借鉴文章<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTYzNzM5OA==&mid=2247508816&idx=1&sn=4f4d55db29cde21d28215fcc6fcb2e17&source=41#wechat_redirect" target="_blank" rel="noopener">给初学者的RxJava2.0教程(一)</a></p>
<p>1.添加 Gradle 配置:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//rxjava</span></span><br><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></span><br><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxjava:2.1.7'</span></span><br></pre></td></tr></table></figure>

<p>假设有两根水管：</p>
<p><img src="/2022/05/16/RxJava2(%E4%B8%80)/1.png" alt></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/16/RxJava2(%E4%B8%80)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="余一"
      src="/images/avatar5.jpg">
  <p class="site-author-name" itemprop="name">余一</p>
  <div class="site-description" itemprop="description">纸上得来终觉浅，绝知此事要躬行。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">172</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.bilibili.com/" title="https:&#x2F;&#x2F;www.bilibili.com&#x2F;" rel="noopener" target="_blank">Bilibili</a>
        </li>
    </ul>
  </div>

	
           
         
         <div style="">
  <canvas id="canvas" style="width:60%;">��ǰ�������֧��canvas������������������</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //����canvas�Ŀ���
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //�洢ʱ������
    var data = [];
    //�洢�˶���С��
    var balls = [];
    //�������Ӱ뾶
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //�洢ʱ�����֣���ʮλСʱ����λСʱ��ð�š�ʮλ���ӡ���λ���ӡ�ð�š�ʮλ���ӡ���λ������7���������
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*���ɵ�������*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*����ʱ��*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //ʱ�䷢���仯
            if(NewData[i] !== data[i]){
                //���仯������ֵ����data�����е������洢��changeNumArray������
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //����С��
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*����С��״̬*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*����Ҫ�˶���С��*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*��Ⱦ*/
    function render(){
        //���û������ȣ��ﵽ��ջ�����Ч��
        canvas.height = 100;
        //��Ⱦʱ��
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //��ȾС��
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //����ʱ��
        updateDigitTime();
        //����С��״̬
        updateBalls();
        //��Ⱦ
        render();
    },50);
}

})();
</script>
      </div>
	
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">余一</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.5m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">22:38</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

  <script async src="/js/cursor/fireworks.js"></script>

</body>
</html>
